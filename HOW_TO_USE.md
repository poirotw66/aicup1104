# ğŸ“– ä½¿ç”¨æŒ‡å—

## ğŸ¯ å¿«é€Ÿé–‹å§‹

### 1. ä¸Šå‚³é æ¸¬çµæœï¼ˆæ¨è–¦ï¼‰

```bash
# ä¸Šå‚³æ–°æ¨¡å‹çš„é æ¸¬çµæœ
ä¸Šå‚³æª”æ¡ˆ: output/predictions_ml_acct_label.csv
```

**é€™å€‹æª”æ¡ˆçš„ç‰¹é»ï¼š**
- âœ… å·²ä¿®æ­£è³‡æ–™æ´©æ¼å•é¡Œ
- âœ… ä½¿ç”¨ Gradient Boosting æ¨¡å‹ï¼ˆCV F1: 0.8870ï¼‰
- âœ… é æ¸¬ç•°å¸¸ç‡ 14.08% (åˆç†ç¯„åœ)
- âœ… é æœŸç·šä¸Š F1-Score: 0.25-0.40

---

## ğŸ“Š æª¢è¦–è¨“ç·´çµæœ

### æŸ¥çœ‹è¨“ç·´å ±å‘Š
```bash
cat output/ml_training_report.json
```

è¼¸å‡ºç¯„ä¾‹ï¼š
```json
{
  "model_name": "gradient_boosting",
  "cv_f1_mean": 0.8870,
  "cv_f1_std": 0.0210,
  "train_metrics": {
    "precision": 1.0,
    "recall": 0.9947,
    "f1_score": 0.9973
  },
  "n_predictions": 4780,
  "n_predicted_alerts": 673,
  "prediction_rate": 0.1408
}
```

### æŸ¥çœ‹å•é¡Œè¨ºæ–·
```bash
cat CRITICAL_ISSUES_FOUND.md  # å•é¡Œåˆ†æ
cat TRAINING_SUCCESS_REPORT.md  # è¨“ç·´æˆåŠŸå ±å‘Š
cat FINAL_SUMMARY.md  # å®Œæ•´ç¸½çµ
```

---

## ğŸ”§ å¦‚æœéœ€è¦èª¿æ•´

### æƒ…æ³ 1: ç·šä¸Š F1 é‚„æ˜¯å¤ªä½ï¼ˆå¦‚ < 0.15ï¼‰

å¯èƒ½åŸå› ï¼šæ¨¡å‹å¤ªä¿å®ˆ

**è§£æ±ºæ–¹æ¡ˆï¼šèª¿æ•´é–¾å€¼**
```bash
# å˜—è©¦ä¸åŒé–¾å€¼
python3 adjust_threshold.py 0.60  # è¼ƒå¯¬é¬†
python3 adjust_threshold.py 0.70  # ä¸­ç­‰
python3 adjust_threshold.py 0.75  # åŸæœ¬ 0.80

# æœƒç”Ÿæˆæ–°çš„é æ¸¬æª”æ¡ˆ
output/predictions_adjusted_acct_label.csv
```

### æƒ…æ³ 2: Precision å¤ªä½ï¼ˆå¤ªå¤šèª¤å ±ï¼‰

**è§£æ±ºæ–¹æ¡ˆï¼šä½¿ç”¨æ›´ä¿å®ˆçš„é–¾å€¼æˆ–æ¨¡å‹**
```bash
# ä½¿ç”¨æ›´é«˜é–¾å€¼
python3 adjust_threshold.py 0.85
python3 adjust_threshold.py 0.90

# æˆ–é‡æ–°è¨“ç·´ï¼Œä¿®æ”¹åƒæ•¸è®“æ¨¡å‹æ›´ä¿å®ˆ
# ç·¨è¼¯ train_ml_model_fast.py
# å¢åŠ  min_samples_leaf, é™ä½ max_depth
```

### æƒ…æ³ 3: Recall å¤ªä½ï¼ˆæ¼æ‰å¤ªå¤šç•°å¸¸ï¼‰

**è§£æ±ºæ–¹æ¡ˆï¼šå¢åŠ è¨“ç·´æ¨£æœ¬æˆ–é™ä½é–¾å€¼**
```bash
# æ–¹æ¡ˆ A: é™ä½é–¾å€¼
python3 adjust_threshold.py 0.50

# æ–¹æ¡ˆ B: å¢åŠ è¨“ç·´æ¨£æœ¬
# ç·¨è¼¯ train_ml_model_fast.py line 82
# ä¿®æ”¹: normal_sample_size=10000

# ç„¶å¾Œé‡æ–°è¨“ç·´
python3 train_ml_model_fast.py
```

---

## ğŸ”„ é‡æ–°è¨“ç·´æ¨¡å‹

### åŸºæœ¬é‡æ–°è¨“ç·´
```bash
python3 train_ml_model_fast.py
```

### ä¿®æ”¹è¨“ç·´åƒæ•¸

ç·¨è¼¯ `train_ml_model_fast.py`:

#### 1. èª¿æ•´è¨“ç·´æ¨£æœ¬æ•¸ï¼ˆline ~82ï¼‰
```python
normal_sample_size=5000   # é è¨­
normal_sample_size=10000  # å¢åŠ æ­£å¸¸æ¨£æœ¬
normal_sample_size=3000   # æ¸›å°‘ï¼ˆå¦‚æœè¨˜æ†¶é«”ä¸è¶³ï¼‰
```

#### 2. èª¿æ•´æ¨¡å‹åƒæ•¸ï¼ˆline ~180ï¼‰
```python
# Gradient Boosting åƒæ•¸
GradientBoostingClassifier(
    n_estimators=200,      # å¢åŠ æ¨¹çš„æ•¸é‡ â†’ æ›´æº–ç¢ºä½†æ›´æ…¢
    max_depth=8,           # å¢åŠ æ·±åº¦ â†’ æ›´è¤‡é›œçš„æ¨¡å¼
    learning_rate=0.05,    # é™ä½å­¸ç¿’ç‡ â†’ æ›´ç©©å®š
    min_samples_leaf=5,    # å¢åŠ  â†’ æ›´ä¿å®ˆï¼ˆæ¸›å°‘éæ“¬åˆï¼‰
    subsample=0.8,         # å­æ¨£æœ¬æ¯”ä¾‹
    random_state=42
)
```

#### 3. é¸æ“‡ä¸åŒæ¨¡å‹
ç¨‹å¼æœƒè‡ªå‹•è¨“ç·´ä¸‰å€‹æ¨¡å‹ä¸¦é¸æœ€å¥½çš„ï¼š
- Random Forest (Balanced)
- Gradient Boosting â­ (é€šå¸¸æœ€å¥½)
- Random Forest (Conservative)

---

## ğŸ“ˆ æ¯”è¼ƒæ¨¡å‹çµæœ

### æ¯”è¼ƒæ–°èˆŠæ¨¡å‹
```bash
python3 compare_models.py
```

è¼¸å‡ºåŒ…æ‹¬ï¼š
- é æ¸¬åˆ†å¸ƒæ¯”è¼ƒ
- ä¿¡å¿ƒåˆ†æ•¸æ¯”è¼ƒ
- é æ¸¬ä¸€è‡´æ€§åˆ†æ
- é«˜ä¿¡å¿ƒé æ¸¬çµ±è¨ˆ

### åˆ†æé æ¸¬çµæœ
```bash
python3 analyze_predictions.py
```

è¼¸å‡ºåŒ…æ‹¬ï¼š
- åŸºæœ¬çµ±è¨ˆ
- ç•°å¸¸æ¯”ä¾‹å°æ¯”
- ä¸åŒé–¾å€¼ä¸‹çš„é æ¸¬åˆ†å¸ƒ
- æ”¹å–„å»ºè­°

---

## ğŸ—‚ï¸ æª”æ¡ˆèªªæ˜

### è¼¸å‡ºæª”æ¡ˆ

| æª”æ¡ˆ | èªªæ˜ | ç”¨é€” |
|------|------|------|
| `predictions_ml_acct_label.csv` | æ–°æ¨¡å‹é æ¸¬ï¼ˆç°¡åŒ–ç‰ˆï¼‰| â­ æäº¤ç”¨ |
| `predictions_ml.csv` | æ–°æ¨¡å‹é æ¸¬ï¼ˆå®Œæ•´ç‰ˆï¼‰| åŒ…å«ä¿¡å¿ƒåˆ†æ•¸ |
| `trained_model.pkl` | è¨“ç·´å¥½çš„æ¨¡å‹ | å¯é‡æ–°è¼‰å…¥ |
| `ml_training_report.json` | è¨“ç·´å ±å‘Š | æŸ¥çœ‹æŒ‡æ¨™ |
| `predictions_adjusted_acct_label.csv` | èª¿æ•´é–¾å€¼å¾Œçš„é æ¸¬ | é–¾å€¼èª¿æ•´å¾Œç”Ÿæˆ |

### è…³æœ¬æª”æ¡ˆ

| è…³æœ¬ | åŠŸèƒ½ | ä½¿ç”¨æ™‚æ©Ÿ |
|------|------|----------|
| `train_ml_model_fast.py` | è¨“ç·´æ–°æ¨¡å‹ | åˆæ¬¡è¨“ç·´æˆ–é‡æ–°è¨“ç·´ |
| `adjust_threshold.py` | èª¿æ•´é æ¸¬é–¾å€¼ | éœ€è¦èª¿æ•´ Precision/Recall |
| `compare_models.py` | æ¯”è¼ƒæ–°èˆŠæ¨¡å‹ | åˆ†æå·®ç•° |
| `analyze_predictions.py` | åˆ†æé æ¸¬çµæœ | æ·±å…¥äº†è§£é æ¸¬ |
| `extract_acct_label.py` | æå– acct, label æ¬„ä½ | æ ¼å¼è½‰æ› |

### æ–‡æª”æª”æ¡ˆ

| æ–‡æª” | å…§å®¹ |
|------|------|
| `FINAL_SUMMARY.md` | å®Œæ•´ç¸½çµï¼ˆæ¨è–¦é–±è®€ï¼‰|
| `TRAINING_SUCCESS_REPORT.md` | è¨“ç·´æˆåŠŸå ±å‘Š |
| `CRITICAL_ISSUES_FOUND.md` | å•é¡Œè¨ºæ–·å ±å‘Š |
| `HOW_TO_USE.md` | æœ¬ä½¿ç”¨æŒ‡å— |

---

## ğŸ’¡ æœ€ä½³å¯¦è¸

### 1. æäº¤å‰æª¢æŸ¥
```bash
# æª¢æŸ¥æª”æ¡ˆæ ¼å¼
head output/predictions_ml_acct_label.csv

# æ‡‰è©²çœ‹åˆ°:
# acct,label
# <64 å­—å…ƒçš„ hash>,0
# <64 å­—å…ƒçš„ hash>,1
# ...

# æª¢æŸ¥è¡Œæ•¸ï¼ˆæ‡‰è©²æ˜¯ 4781 è¡Œï¼ŒåŒ…å«è¡¨é ­ï¼‰
wc -l output/predictions_ml_acct_label.csv
```

### 2. è¨˜éŒ„æäº¤çµæœ
å»ºè­°å‰µå»ºä¸€å€‹è¨˜éŒ„æª”ï¼š
```bash
echo "æäº¤æ™‚é–“: $(date)" >> submission_log.txt
echo "æª”æ¡ˆ: predictions_ml_acct_label.csv" >> submission_log.txt
echo "é æ¸¬ç•°å¸¸æ•¸: 673 (14.08%)" >> submission_log.txt
echo "æ¨¡å‹: Gradient Boosting (CV F1: 0.8870)" >> submission_log.txt
echo "ç·šä¸Š F1: [å¡«å…¥å¯¦éš›çµæœ]" >> submission_log.txt
echo "---" >> submission_log.txt
```

### 3. è¿­ä»£æ”¹é€²æµç¨‹
```
1. ä¸Šå‚³ predictions_ml_acct_label.csv
   â†“
2. æŸ¥çœ‹ç·šä¸Š F1-Score
   â†“
3. å¦‚æœä¸ç†æƒ³:
   a) F1 < 0.15: èª¿æ•´é–¾å€¼ (adjust_threshold.py)
   b) Precision ä½: æé«˜é–¾å€¼æˆ–é‡è¨“ç·´
   c) Recall ä½: é™ä½é–¾å€¼æˆ–å¢åŠ æ¨£æœ¬
   â†“
4. é‡è¤‡ç›´åˆ°æ»¿æ„
```

---

## â“ å¸¸è¦‹å•é¡Œ

### Q1: ç‚ºä»€éº¼æ–°æ¨¡å‹é æ¸¬çš„ç•°å¸¸æ•¸æ¯”èˆŠæ¨¡å‹å°‘å¾ˆå¤šï¼Ÿ

**A:** èˆŠæ¨¡å‹æœ‰è³‡æ–™æ´©æ¼å’Œé–¾å€¼è¨­å®šå•é¡Œï¼Œå°è‡´éåº¦é æ¸¬ï¼ˆ63.7%ï¼‰ã€‚æ–°æ¨¡å‹ä¿®æ­£äº†é€™äº›å•é¡Œï¼Œæ›´ä¿å®ˆä½†æ›´æº–ç¢ºï¼ˆ14.1%ï¼‰ã€‚é€™å€‹æ¯”ä¾‹æ›´æ¥è¿‘è¨“ç·´é›†çš„ç•°å¸¸ç‡ï¼ˆ21%ï¼‰ã€‚

### Q2: äº¤å‰é©—è­‰ F1 æ˜¯ 0.887ï¼Œç‚ºä»€éº¼é æœŸç·šä¸Šåªæœ‰ 0.25-0.40ï¼Ÿ

**A:** äº¤å‰é©—è­‰æ˜¯åœ¨è¨“ç·´é›†ä¸Šçš„è¡¨ç¾ã€‚ç·šä¸Šæ¸¬è©¦é›†å¯èƒ½ï¼š
- è³‡æ–™åˆ†å¸ƒä¸åŒ
- åŒ…å«è¨“ç·´æ™‚æ²’è¦‹éçš„æ¨¡å¼
- æ™‚é–“ç¯„åœä¸åŒ

æ‰€ä»¥ç·šä¸Šè¡¨ç¾é€šå¸¸æœƒæ¯” CV ä½ã€‚

### Q3: å¯ä»¥ä½¿ç”¨èˆŠæ¨¡å‹çš„é æ¸¬å—ï¼Ÿ

**A:** ä¸æ¨è–¦ã€‚èˆŠæ¨¡å‹çš„å•é¡Œï¼š
- è¨“ç·´é›† F1 åªæœ‰ 0.0207ï¼ˆå¤ªå·®ï¼‰
- é æ¸¬ 63.7% ç•°å¸¸ï¼ˆéåº¦é æ¸¬ï¼‰
- æœ‰è³‡æ–™æ´©æ¼å•é¡Œ

### Q4: è¨“ç·´éœ€è¦å¤šä¹…ï¼Ÿ

**A:** 
- è¼‰å…¥è³‡æ–™: ~20 ç§’
- è¨“ç·´æ¨¡å‹: ~1.5 åˆ†é˜
- é æ¸¬: ~20 ç§’
- ç¸½å…±: ~2.3 åˆ†é˜

### Q5: è¨˜æ†¶é«”æœƒä¸æœƒä¸å¤ ï¼Ÿ

**A:** å·²å„ªåŒ–ç‚ºåˆ†æ‰¹è™•ç†ï¼š
- ä¸€æ¬¡åªè¼‰å…¥ 100,000 ç­†
- å³°å€¼è¨˜æ†¶é«”ç´„ 2-3 GB
- ä¸€èˆ¬é›»è…¦éƒ½å¯ä»¥é‹è¡Œ

### Q6: å¦‚æœç·šä¸Š F1 é‚„æ˜¯å¾ˆä½æ€éº¼è¾¦ï¼Ÿ

**A:** æŒ‰é †åºå˜—è©¦ï¼š
1. èª¿æ•´é–¾å€¼ï¼ˆæœ€å¿«ï¼‰
2. æª¢æŸ¥æ¸¬è©¦é›†æ˜¯å¦èˆ‡è¨“ç·´é›†å·®ç•°å¤ªå¤§
3. å¢åŠ è¨“ç·´æ¨£æœ¬é‡æ–°è¨“ç·´
4. å˜—è©¦å…¶ä»–æ¨¡å‹æˆ–ç‰¹å¾µå·¥ç¨‹

---

## ğŸ¯ æˆåŠŸæŒ‡æ¨™

### å¯æ¥å—çš„çµæœ
- ç·šä¸Š F1-Score > 0.20
- é æ¸¬ç•°å¸¸ç‡åœ¨ 10-25% ä¹‹é–“

### è‰¯å¥½çš„çµæœ
- ç·šä¸Š F1-Score > 0.30
- Precision > 0.20
- Recall > 0.40

### å„ªç§€çš„çµæœ
- ç·šä¸Š F1-Score > 0.40
- Precision > 0.30
- Recall > 0.50

---

## ğŸ“ Debug æµç¨‹

å¦‚æœé‡åˆ°å•é¡Œï¼š

1. **æª¢æŸ¥æª”æ¡ˆæ˜¯å¦å­˜åœ¨**
   ```bash
   ls -lh output/features.csv
   ls -lh output/predictions_ml_acct_label.csv
   ```

2. **æŸ¥çœ‹éŒ¯èª¤è¨Šæ¯**
   è¨“ç·´è…³æœ¬æœ‰è©³ç´°çš„éŒ¯èª¤æç¤º

3. **æª¢æŸ¥è³‡æ–™å®Œæ•´æ€§**
   ```bash
   wc -l raw_data/acct_alert.csv     # æ‡‰è©²æ˜¯ 1005
   wc -l raw_data/acct_predict.csv   # æ‡‰è©²æ˜¯ 4781
   ```

4. **é‡æ–°åŸ·è¡Œ**
   ```bash
   python3 train_ml_model_fast.py
   ```

---

## ğŸš€ ç«‹å³è¡Œå‹•

```bash
# 1. ä¸Šå‚³é æ¸¬çµæœ
ä¸Šå‚³: output/predictions_ml_acct_label.csv

# 2. ç­‰å¾…ç·šä¸Šè©•åˆ†

# 3. æ ¹æ“šçµæœæ±ºå®šä¸‹ä¸€æ­¥
å¦‚æœ F1 > 0.25: æˆåŠŸï¼âœ…
å¦‚æœ F1 < 0.25: èª¿æ•´é–¾å€¼æˆ–é‡æ–°è¨“ç·´
```

---

**ç¥æ‚¨å–å¾—å¥½æˆç¸¾ï¼** ğŸ‰

