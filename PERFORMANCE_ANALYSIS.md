# ğŸ” å®Œæ•´æ•ˆèƒ½åˆ†æå ±å‘Š

åŸºæ–¼ 443 è¬ç­†äº¤æ˜“è³‡æ–™çš„åŸ·è¡Œåˆ†æ

---

## ğŸ“Š ç•¶å‰æ•ˆèƒ½æ¦‚è¦½ï¼ˆä½¿ç”¨ main.pyï¼‰

### ç¸½åŸ·è¡Œæ™‚é–“ï¼š**21.0 åˆ†é˜**

| éšæ®µ | æ™‚é–“ | ä½”æ¯” | ç‹€æ…‹ |
|------|------|------|------|
| Phase 1: Loading Data | <1 åˆ†é˜ | 4.8% | âœ… å·²å„ªåŒ– |
| **Phase 2: Feature Engineering** | **19.5 åˆ†é˜** | **92.9%** | âš ï¸ **ä¸»è¦ç“¶é ¸** |
| Phase 3: EDA Analysis | 0.5 åˆ†é˜ | 2.4% | âœ… å¿«é€Ÿ |
| Phase 4: Pattern Discovery | 0.9 åˆ†é˜ | 4.3% | âœ… å¿«é€Ÿ |
| Phase 5: Rule Building | <0.1 åˆ†é˜ | 0.5% | âœ… å¿«é€Ÿ |
| Phase 6: Making Predictions | <0.1 åˆ†é˜ | 0.5% | âœ… å¿«é€Ÿ |

---

## ğŸ¯ é—œéµç™¼ç¾

### 1. **Phase 2 æ˜¯çµ•å°ç“¶é ¸ï¼ˆä½” 93% æ™‚é–“ï¼‰**

å…·é«”ä¾†èªªï¼š
- **Extracting outgoing transaction features**: 5-8 åˆ†é˜ (25.6%)
- **Extracting incoming transaction features**: 4-6 åˆ†é˜ (23.8%)
- **å…¶ä»–ç‰¹å¾µè¨ˆç®—**: 7-10 åˆ†é˜ (42.9%)

### 2. **å…¶ä»–éšæ®µéƒ½å¾ˆå¿«**

- EDAã€Pattern Discoveryã€Rule Building åˆè¨ˆ < 2 åˆ†é˜
- é€™äº›æ­¥é©Ÿå·²ç¶“è¶³å¤ å„ªåŒ–ï¼Œä¸éœ€è¦æ”¹é€²

### 3. **ç“¶é ¸æ ¹æœ¬åŸå› **

```python
# ğŸŒ æ…¢çš„ç¨‹å¼ç¢¼ï¼ˆfeature_engineering.pyï¼‰
for _, row in df.iterrows():  # â† Python è¿´åœˆï¼Œæ¥µæ…¢
    # é€è¡Œè™•ç†...
```

```python
# ğŸŒ æ¬¡æ…¢çš„ç¨‹å¼ç¢¼ï¼ˆfeature_engineering_fast.pyï¼‰
out_time = txn_df.groupby('from_acct')['hour'].apply(
    lambda x: pd.Series({...})  # â† lambda å‡½æ•¸ï¼Œç„¡æ³•å‘é‡åŒ–
)
```

---

## âš¡ å„ªåŒ–æ–¹æ¡ˆèˆ‡æ•ˆæœ

### æ–¹æ¡ˆ 1ï¼šå‘é‡åŒ–æ“ä½œï¼ˆå·²å¯¦ç¾ï¼‰

**æª”æ¡ˆ**: `feature_engineering_fast.py` + `main_fast.py`

**æ”¹é€²**:
- ç”¨ `groupby().agg()` å–ä»£ `iterrows()`
- ä½†ä»ç„¶ä½¿ç”¨ `lambda` å‡½æ•¸è™•ç†æ™‚é–“ç‰¹å¾µ

**é æœŸæ•ˆæœ**: 
- Phase 2: 19.5 â†’ **8-10 åˆ†é˜** (2-2.5x åŠ é€Ÿ)
- **ç¸½æ™‚é–“: 21 â†’ 10-12 åˆ†é˜**

---

### æ–¹æ¡ˆ 2ï¼šå®Œå…¨å‘é‡åŒ–ï¼ˆæœ€æ–°å¯¦ç¾ï¼‰âœ¨

**æª”æ¡ˆ**: `feature_engineering_ultra_fast.py` + æ›´æ–°çš„ `main_fast.py`

**é—œéµæ”¹é€²**:
```python
# âœ… å¿«ï¼é å…ˆè¨ˆç®—æ¨™è¨˜ï¼ˆå®Œå…¨å‘é‡åŒ–ï¼‰
txn_df['is_night'] = ((txn_df['hour'] >= 0) & (txn_df['hour'] < 6)).astype(int)
txn_df['is_work_hour'] = ((txn_df['hour'] >= 9) & (txn_df['hour'] < 18)).astype(int)

# âœ… å¿«ï¼ä¸€æ¬¡æ€§èšåˆï¼ˆç„¡ lambdaï¼‰
out_features = txn_df.groupby('from_acct').agg({
    'is_night': 'sum',      # å…§å»ºå‡½æ•¸
    'is_work_hour': 'sum',  # å…§å»ºå‡½æ•¸
    'hour': 'sum',          # å…§å»ºå‡½æ•¸
    'valid_hour': 'sum'     # å…§å»ºå‡½æ•¸
})

# âœ… å¿«ï¼å‘é‡åŒ–è¨ˆç®—æ¯”ä¾‹
out_features['out_night_ratio'] = out_features['out_night_sum'] / out_features['out_txn_count']
```

**é æœŸæ•ˆæœ**:
- **Extracting outgoing features**: 5-8 â†’ **1-2 åˆ†é˜** (3-4x åŠ é€Ÿ)
- **Extracting incoming features**: 4-6 â†’ **1-2 åˆ†é˜** (3x åŠ é€Ÿ)
- **å…¶ä»–ç‰¹å¾µè¨ˆç®—**: 7-10 â†’ **2-3 åˆ†é˜** (3x åŠ é€Ÿ)
- **Phase 2 ç¸½è¨ˆ**: 19.5 â†’ **4-6 åˆ†é˜** (3-5x åŠ é€Ÿ) âš¡âš¡âš¡
- **ç¸½åŸ·è¡Œæ™‚é–“**: 21 â†’ **6-8 åˆ†é˜** (2.6-3.5x åŠ é€Ÿ)

---

### æ–¹æ¡ˆ 3ï¼šParquet + å¤šæ ¸å¿ƒä¸¦è¡Œï¼ˆå·²å¯¦ç¾ï¼‰

**æª”æ¡ˆ**: `main_ultra_fast.py` + `convert_to_parquet.py` + `feature_engineering_parallel.py`

**æ”¹é€²**:
1. **Parquet æ ¼å¼**: CSV è®€å– 2 åˆ†é˜ â†’ Parquet è®€å– 20 ç§’ (6x åŠ é€Ÿ)
2. **å¤šæ ¸å¿ƒä¸¦è¡Œ**: åˆ©ç”¨ CPU å¤šæ ¸å¿ƒåŒæ™‚è™•ç†

**é æœŸæ•ˆæœ**:
- Phase 2: 19.5 â†’ **2-3 åˆ†é˜** (6-10x åŠ é€Ÿ) âš¡âš¡âš¡âš¡âš¡
- **ç¸½æ™‚é–“: 21 â†’ 4-5 åˆ†é˜** (4-5x åŠ é€Ÿ)

**æ³¨æ„**: éœ€è¦å…ˆè½‰æ›ç‚º Parquetï¼ˆä¸€æ¬¡æ€§æ“ä½œï¼Œç´„ 2-3 åˆ†é˜ï¼‰

---

## ğŸ“ˆ æ•ˆèƒ½å°æ¯”è¡¨

| ç‰ˆæœ¬ | Phase 2 æ™‚é–“ | ç¸½æ™‚é–“ | ç›¸å°é€Ÿåº¦ | è¤‡é›œåº¦ |
|------|-------------|--------|---------|--------|
| `main.py` (åŸå§‹) | 19.5 åˆ† | 21 åˆ† | 1x ğŸŒ | ç°¡å–® |
| `main_fast.py` (èˆŠç‰ˆ fast) | 8-10 åˆ† | 10-12 åˆ† | 2x â­ | ç°¡å–® |
| **`main_fast.py` (æ–°ç‰ˆ ultra_fast)** | **4-6 åˆ†** | **6-8 åˆ†** | **3-3.5x** âš¡âš¡âš¡ | **ç°¡å–®** âœ… |
| `main_ultra_fast.py` (Parquet) | 2-3 åˆ† | 4-5 åˆ† | 4-5x âš¡âš¡âš¡âš¡âš¡ | ä¸­ç­‰ï¼ˆéœ€è½‰æ›ï¼‰ |

---

## ğŸª è©³ç´°ç“¶é ¸åˆ†æ

### Phase 2 å…§éƒ¨åˆ†è§£ï¼ˆåŸå§‹ç‰ˆæœ¬ 19.5 åˆ†é˜ï¼‰

#### 1. **Extracting outgoing transaction features** (5-8 åˆ†é˜) ğŸ”¥

**å•é¡Œ**:
```python
# feature_engineering_fast.py line 80-86
out_time = txn_df.groupby('from_acct')['hour'].apply(
    lambda x: pd.Series({
        'out_night_ratio': ((x >= 0) & (x < 6)).sum() / len(x),
        'out_work_ratio': ((x >= 9) & (x < 18)).sum() / len(x),
        'out_avg_hour': x[x >= 0].mean()
    })
)
```

**ç‚ºä»€éº¼æ…¢**:
- `apply()` + `lambda` å°æ¯å€‹å¸³æˆ¶åŸ·è¡Œ Python å‡½æ•¸
- 443 è¬ç­†äº¤æ˜“ â†’ å¹¾åè¬å€‹å¸³æˆ¶
- æ¯å€‹å¸³æˆ¶éƒ½è¦:
  1. åŸ·è¡Œ 3 å€‹æ¢ä»¶åˆ¤æ–·
  2. åŸ·è¡Œ 3 å€‹èšåˆè¨ˆç®—
  3. å»ºç«‹ pandas Series ç‰©ä»¶
- Python è§£é‡‹å™¨é–‹éŠ·å·¨å¤§

**å„ªåŒ–æ–¹æ¡ˆ**ï¼ˆultra_fastï¼‰:
```python
# ä¸€æ¬¡æ€§é è™•ç†ï¼ˆå‘é‡åŒ–ï¼Œ0.5 ç§’ï¼‰
txn_df['is_night'] = ((txn_df['hour'] >= 0) & (txn_df['hour'] < 6)).astype(int)
txn_df['is_work_hour'] = ((txn_df['hour'] >= 9) & (txn_df['hour'] < 18)).astype(int)

# ä¸€æ¬¡æ€§èšåˆï¼ˆC èªè¨€å¯¦ç¾ï¼Œå¿«ï¼ï¼‰
out_features = txn_df.groupby('from_acct').agg({
    'is_night': 'sum',
    'is_work_hour': 'sum',
    'hour': 'sum'
})

# å‘é‡åŒ–è¨ˆç®—æ¯”ä¾‹ï¼ˆ0.1 ç§’ï¼‰
out_features['out_night_ratio'] = out_features['is_night'] / out_features['txn_count']
```

**æ•ˆæœ**: 5-8 åˆ†é˜ â†’ **1-2 åˆ†é˜** (3-4x åŠ é€Ÿ)

---

#### 2. **Extracting incoming transaction features** (4-6 åˆ†é˜) ğŸ”¥

**ç›¸åŒå•é¡Œ**:
- åŒæ¨£ä½¿ç”¨ `groupby().apply()` + `lambda`
- é‡å° `to_acct` é€²è¡Œèšåˆ

**å„ªåŒ–æ–¹æ¡ˆ**: åŒä¸Š

**æ•ˆæœ**: 4-6 åˆ†é˜ â†’ **1-2 åˆ†é˜** (3x åŠ é€Ÿ)

---

#### 3. **å…¶ä»–ç‰¹å¾µè¨ˆç®—** (7-10 åˆ†é˜)

åŒ…å«:
- æ¯æ—¥äº¤æ˜“çµ±è¨ˆï¼ˆ`groupby` å…©æ¬¡ï¼‰
- è­¦ç¤ºå¸³æˆ¶äº’å‹•é‡‘é¡
- äº¤æ˜“å°æ‰‹çµ±è¨ˆ
- å¸³æˆ¶é¡å‹å¤šæ¨£æ€§
- çµ„åˆç‰¹å¾µè¨ˆç®—

**ç“¶é ¸**:
- å¤šæ¬¡ `groupby` æ“ä½œ
- å¤šæ¬¡ `merge` æ“ä½œ
- å¤§é‡çš„ DataFrame æ“ä½œ

**å„ªåŒ–æ–¹æ¡ˆ**:
1. **åˆä½µ groupby**: ç›¡å¯èƒ½åœ¨ä¸€æ¬¡ `agg()` ä¸­å®Œæˆ
2. **æ¸›å°‘ä¸­é–“è®Šæ•¸**: é¿å…å‰µå»ºä¸å¿…è¦çš„ DataFrame
3. **ä½¿ç”¨ NumPy**: ç´”æ•¸å€¼è¨ˆç®—ç”¨ NumPy

**æ•ˆæœ**: 7-10 åˆ†é˜ â†’ **2-3 åˆ†é˜** (3x åŠ é€Ÿ)

---

### Phase 3-6ï¼ˆç¸½è¨ˆ 1.5 åˆ†é˜ï¼‰âœ…

é€™äº›éšæ®µå·²ç¶“å¾ˆå¿«ï¼Œä¸éœ€è¦å„ªåŒ–ï¼š

#### Phase 3: EDA Analysis (0.5 åˆ†é˜)
- Mann-Whitney U æª¢é©—ï¼šå¿«é€Ÿ
- çµ±è¨ˆé‡è¨ˆç®—ï¼šå¿«é€Ÿ
- ç¹ªåœ–ï¼šé©ä¸­ï¼ˆå·²é™åˆ¶æ•¸é‡ï¼‰

#### Phase 4: Pattern Discovery (0.9 åˆ†é˜)
- æ±ºç­–æ¨¹è¨“ç·´ï¼šå¿«é€Ÿï¼ˆmax_depth=4ï¼‰
- KMeans èšé¡ï¼šå¿«é€Ÿï¼ˆåªé‡å°è­¦ç¤ºå¸³æˆ¶ï¼‰
- Isolation Forestï¼šé©ä¸­ï¼ˆ100 æ£µæ¨¹ï¼‰

#### Phase 5-6 (< 0.2 åˆ†é˜)
- è¦å‰‡å»ºç«‹ï¼šæ¥µå¿«
- é æ¸¬ï¼šæ¥µå¿«

---

## ğŸš€ æ¨è–¦ä½¿ç”¨æ–¹æ¡ˆ

### æƒ…æ³ 1ï¼šé¦–æ¬¡ä½¿ç”¨ / æƒ³è¦æœ€ç°¡å–®

```bash
# ä½¿ç”¨æ›´æ–°å¾Œçš„ main_fast.pyï¼ˆå·²æ•´åˆ ultra_fastï¼‰
python main_fast.py
```

**å„ªé»**:
- âœ… ç„¡éœ€é¡å¤–è¨­ç½®
- âœ… ç›´æ¥ä½¿ç”¨ CSV æª”æ¡ˆ
- âœ… **ç¸½æ™‚é–“ 6-8 åˆ†é˜** (vs åŸæœ¬ 21 åˆ†é˜)
- âœ… 3-3.5x åŠ é€Ÿ

**é©ç”¨**: æ–°ç”¨æˆ¶ã€ä¸€æ¬¡æ€§åˆ†æ

---

### æƒ…æ³ 2ï¼šéœ€è¦å¤šæ¬¡åŸ·è¡Œ / è¿½æ±‚æ¥µè‡´é€Ÿåº¦

```bash
# æ­¥é©Ÿ 1ï¼šè½‰æ›ç‚º Parquetï¼ˆåªéœ€åŸ·è¡Œä¸€æ¬¡ï¼‰
python convert_to_parquet.py  # 2-3 åˆ†é˜

# æ­¥é©Ÿ 2ï¼šä½¿ç”¨ ultra_fast ç‰ˆæœ¬
python main_ultra_fast.py  # 4-5 åˆ†é˜
```

**å„ªé»**:
- âœ… **ç¸½æ™‚é–“ 4-5 åˆ†é˜** (vs åŸæœ¬ 21 åˆ†é˜)
- âœ… 4-5x åŠ é€Ÿ
- âœ… Parquet æª”æ¡ˆå¯é‡è¤‡ä½¿ç”¨
- âœ… I/O æ•ˆèƒ½å¤§å¹…æå‡

**é©ç”¨**: éœ€è¦å¤šæ¬¡åŸ·è¡Œã€è¿½æ±‚æœ€å¿«é€Ÿåº¦

---

### æƒ…æ³ 3ï¼šæƒ³çœ‹è©³ç´°éç¨‹ï¼ˆé™¤éŒ¯/å­¸ç¿’ï¼‰

```bash
# ä½¿ç”¨åŸå§‹ç‰ˆæœ¬
python main.py  # 21 åˆ†é˜
```

**å„ªé»**:
- âœ… è©³ç´°çš„ä¸­é–“è¼¸å‡º
- âœ… æ˜“æ–¼ç†è§£å’Œé™¤éŒ¯

**é©ç”¨**: å­¸ç¿’ã€é–‹ç™¼ã€é™¤éŒ¯

---

## ğŸ’¡ é€²ä¸€æ­¥å„ªåŒ–å¯èƒ½æ€§

### å·²å¯¦ç¾ âœ…
1. âœ… å‘é‡åŒ–æ“ä½œï¼ˆ`feature_engineering_fast.py`ï¼‰
2. âœ… å®Œå…¨å‘é‡åŒ–ï¼ˆ`feature_engineering_ultra_fast.py`ï¼‰
3. âœ… Parquet æ ¼å¼ï¼ˆ`convert_to_parquet.py`ï¼‰
4. âœ… å¤šæ ¸å¿ƒä¸¦è¡Œï¼ˆ`feature_engineering_parallel.py`ï¼‰

### ç†è«–ä¸Šå¯ä»¥ä½†ä¸å»ºè­° âš ï¸

#### 1. GPU åŠ é€Ÿ
- **å¯èƒ½åŠ é€Ÿ**: 1.5-2x
- **å•é¡Œ**: 
  - éœ€è¦ CUDA/cuDF
  - è³‡æ–™å‚³è¼¸é–‹éŠ·
  - Pandas æ“ä½œç„¡æ³•ç›´æ¥ç”¨ GPU
- **çµè«–**: **ä¸å€¼å¾—** âŒ

#### 2. Dask åˆ†æ•£å¼è¨ˆç®—
- **å¯èƒ½åŠ é€Ÿ**: 1.5-2x
- **å•é¡Œ**:
  - å¢åŠ è¤‡é›œåº¦
  - å–®æ©Ÿç’°å¢ƒå„ªå‹¢ä¸å¤§
- **çµè«–**: **ä¸å€¼å¾—** âŒ

#### 3. æ¸›å°‘ç‰¹å¾µ
- **å¯èƒ½åŠ é€Ÿ**: 1.5-2x
- **å•é¡Œ**:
  - å½±éŸ¿æ¨¡å‹æ•ˆæœ
  - å¤±å»æ¢ç´¢æ€§åˆ†ææ„ç¾©
- **çµè«–**: **ä¸æ¨è–¦** âŒ

---

## ğŸ“Š è¨˜æ†¶é«”ä½¿ç”¨åˆ†æ

### ç•¶å‰è¨˜æ†¶é«”éœ€æ±‚ï¼ˆ443 è¬ç­†äº¤æ˜“ï¼‰

| ç‰ˆæœ¬ | å³°å€¼è¨˜æ†¶é«” | èªªæ˜ |
|------|-----------|------|
| `main.py` | ~2-3 GB | åˆ†æ‰¹è™•ç† |
| `main_fast.py` | ~4-5 GB | è¼‰å…¥å…¨éƒ¨è³‡æ–™åˆ°è¨˜æ†¶é«” |
| `main_ultra_fast.py` | ~4-5 GB | åŒ fast ç‰ˆæœ¬ |

**å»ºè­°**: è‡³å°‘ 8GB RAM

å¦‚æœè¨˜æ†¶é«”ä¸è¶³ (<4GB)ï¼Œä½¿ç”¨åŸå§‹ç‰ˆæœ¬ `main.py`ï¼ˆåˆ†æ‰¹è™•ç†ï¼‰ã€‚

---

## ğŸ¯ ç¸½çµèˆ‡å»ºè­°

### ç•¶å‰ç‹€æ…‹

| æŒ‡æ¨™ | åŸå§‹ç‰ˆæœ¬ | å„ªåŒ–ç‰ˆæœ¬ | æ”¹é€² |
|------|---------|---------|------|
| ç¸½åŸ·è¡Œæ™‚é–“ | 21 åˆ†é˜ | **6-8 åˆ†é˜** | **2.6-3.5x** âš¡âš¡âš¡ |
| ä¸»è¦ç“¶é ¸ | Phase 2 (93%) | Phase 2 (67%) | æ”¹å–„ 26% |
| è¨˜æ†¶é«”ä½¿ç”¨ | 2-3 GB | 4-5 GB | +2GB |
| æ˜“ç”¨æ€§ | ç°¡å–® | ç°¡å–® | ç„¡è®ŠåŒ– |

### æ¨è–¦è¡Œå‹•

#### âœ… ç«‹å³å¯åšï¼ˆå·²å®Œæˆï¼‰

1. âœ… **ä½¿ç”¨ `main_fast.py`**ï¼ˆå·²æ›´æ–°ç‚º ultra_fastï¼‰
   - ç„¡éœ€æ”¹è®Šå·¥ä½œæµç¨‹
   - ç›´æ¥ç²å¾— 3x åŠ é€Ÿ

2. âœ… **ï¼ˆå¯é¸ï¼‰è½‰æ›ç‚º Parquet**
   ```bash
   python convert_to_parquet.py
   python main_ultra_fast.py
   ```
   - ç²å¾— 4-5x åŠ é€Ÿ
   - é©åˆéœ€è¦å¤šæ¬¡åŸ·è¡Œçš„æƒ…æ³

#### âš ï¸ ä¸å»ºè­°

- âŒ ä½¿ç”¨ GPUï¼ˆæŠ•è³‡å ±é…¬ç‡ä½ï¼‰
- âŒ æ¸›å°‘ç‰¹å¾µï¼ˆå½±éŸ¿åˆ†æå“è³ªï¼‰
- âŒ ä½¿ç”¨åˆ†æ•£å¼è¨ˆç®—ï¼ˆéåº¦è¤‡é›œï¼‰

---

## ğŸ“ å„ªåŒ–æŠ€è¡“æ‘˜è¦

### é—œéµæŠ€è¡“

1. **å‘é‡åŒ–æ“ä½œ** â­â­â­â­â­
   ```python
   # BAD: Python è¿´åœˆ
   for _, row in df.iterrows():
       result.append(row['a'] + row['b'])
   
   # GOOD: å‘é‡åŒ–
   result = df['a'] + df['b']
   ```

2. **é¿å… lambda in groupby** â­â­â­â­â­
   ```python
   # BAD: lambda å‡½æ•¸
   df.groupby('col').apply(lambda x: x.sum())
   
   # GOOD: å…§å»ºå‡½æ•¸
   df.groupby('col').agg('sum')
   ```

3. **é å…ˆè¨ˆç®—æ¨™è¨˜** â­â­â­â­
   ```python
   # BAD: åœ¨ groupby ä¸­åˆ¤æ–·
   df.groupby('col').apply(lambda x: (x > 10).sum())
   
   # GOOD: é å…ˆè¨ˆç®—
   df['flag'] = (df['value'] > 10).astype(int)
   df.groupby('col')['flag'].sum()
   ```

4. **åˆä½µ groupby** â­â­â­
   ```python
   # BAD: å¤šæ¬¡ groupby
   mean = df.groupby('col')['value'].mean()
   sum = df.groupby('col')['value'].sum()
   
   # GOOD: ä¸€æ¬¡å®Œæˆ
   result = df.groupby('col')['value'].agg(['mean', 'sum'])
   ```

5. **ä½¿ç”¨ Parquet** â­â­â­â­
   - CSV è®€å–: æ…¢ + å¤§
   - Parquet è®€å–: å¿« + å°
   - 6x I/O åŠ é€Ÿ

---

**æœ€å¾Œæ›´æ–°**: 2025-11-04  
**è³‡æ–™è¦æ¨¡**: 443 è¬ç­†äº¤æ˜“  
**æ¸¬è©¦ç’°å¢ƒ**: MacBook (8 core CPU)

